# Delectus 2 Storefiles Reference

## Metadata

Table name: "Delectus"

| rowid     | key              | value             |
| --------- | ---------------- | ----------------- |
| _integer_ | 'format_version' | '2.0.0'           |
| _integer_ | 'storeid'        | _identity-string_ |
| _integer_ | 'username'       | _username_        |
| _integer_ | 'state'          | _changelog_hash_  |

An _identity-string_ is a 32-character hexadecimal string generated by
the Delectus MAKE-IDENTITY function.

A _username_ is string that identifies a valid Delectus account, or,
in the case of a store created by an unregistered user, the string
'anonymous'.

A _changelog_hash_ is an SHA3 digest of the contents of the Changelog.

## Changelog

Table name: "Changelog"

| rowid     | timestamp   | message          |
| --------- | ----------- | ---------------- |
| _integer_ | _timestamp_ | _change_message_ |
|       ... |         ... |              ... |

The _timestamp_ is an ISO 8601 time string identifying the moment when
the change message was issued.

The _change_message_ is a string representing the S-expression form of
a change message (see "changes.md").

## Directory

Table name: "Directory"

| rowid | identity          | title    | type          |
| ----- | ----------------- | -------- | ------------- |
|     1 | _identity-string_ | _string_ | _object-type_ |
|   ... |               ... |      ... |           ... |

_object-type_ is either 'List' or 'Collection'.

## List tables

Table name: "_identity-string_"

The name of a List table is the identity string assigned to the List
when it's created. For example, if the List is granted the identity
"DEAFFE61BEB917BD985ED70D39F751E1" then that is also the name of the
table that stores the contents of the List.

| rowid     | deleted?  | Item | ... |
| --------- | --------- | ---- | --- |
| _integer_ | _Boolean_ |  ... | ... |
|       ... |       ... |  ... | ... |

The List table is created with the columns "rowid", "deleted?", and
"Item".

The user may rename any column except "rowid" and "deleted?". The User
may also mark any column deleted except "rowid" and "deleted?".

The "deleted?" column tracks whether each individual row in the List
is marked deleted.

The user-assigned type and deleted status of columns is stored in the
List metadata table for this List.

## List metadata tables

Table name: "_identity-string_ metadata"

The name of a List's metadata table is the identity string assigned to
the List, followed by a single space, followed by the word
"metadata". For example, if the List is granted the identity
"DEAFFE61BEB917BD985ED70D39F751E1" then the name of the table that
stores the List's metadata is:

"DEAFFE61BEB917BD985ED70D39F751E1 metadata"

| rowid     | column   | order     | type          | deleted?  |
| --------- | -------- | --------- | ------------- | --------- |
| _integer_ | _string_ | _integer_ | _value_type_  | _Boolean_ |
|       ... |      ... |       ... |           ... |       ... |

The "column" column gives the labels of user-defined columns in the
List table that corresponds to this metadata table.

The "order" column contains integers from 0 to 1 less than the count
of user-defined columns. These integers are a hint to clients about
the order that the user perfers to see the columns displayed.

The "type" column gives the user-assigned type of values in the
corresponding column of the List table. Recognized value types include:

- Boolean
- Number
- String

The "deleted?" column indicates whether the named column is marked
deleted.

## Collection Tables

Table name: "_identity-string_"

The name of a Collection table is the identity string assigned to the
Collection when it's created. For example, if the Collection is
granted the identity "DEAFFE61BEB917BD985ED70D39F751E1" then that is
also the name of the table that stores the contents of the Collection.

| rowid     | deleted?  | identity           | title    | type          |
| --------- | --------- | ------------------ | -------- | ------------- |
| _integer_ | _Boolean_ | _identity-string_  | _string_ | _object_type_ |
|       ... |       ... |                ... |      ... |           ... |

_object-type_ is either 'List' or 'Collection'.

