= Delectus 2 Data Format
:toc:name: value

== Concepts

A Delectus *list* is a named set of *items*.

An *item* is a set of *fields*. Each *field* contains a *value*. Each field belongs to exactly one *column*.

Every item in a given list has the same set of columns as all the others. The fields and their values, though, are unique per item.

== Storage

Delectus 2 stores lists in *listfiles*. A Delectus 2 listfile is a SQLite 3 database containing five persistent tables and one transient table:

[cols="1,1,5",options="header"]
.Delectus 2 SQLite tables
|===
| name | lifespan | Description
| `*"delectus"*` | persistent | List metadata.
| `*"listnames"*` | persistent | The user-assignedname of the list.
| `*"comments"*` | persistent | A user-assigned comment describing the list.
| `*"columns"*` | persistent | The currently-defined columns and their attributes.
| `*"items"*` | persistent | The currently-defined list items and their contents.
| `*"latest_items"*` | transient | The latest versions of all defined list items.
|===

Each table stores a log of *edits*. An edit is a tuple that asserts a change to the list--either to its name, its comment text, its columns and their attributes, or its items. The current state of the list at any given time is just the state recorded in the latest edits to all of these aspects of the list.

=== The `"delectus"` table

The `"delectus"` table stores metadata that identifies the list and the version of the file format. It also contains timestamps identifying the time of the list's creation and its latest modification.

[cols="1,1,4",options="header"]
|===
| column | type | description
| `listid` | `string` | The unique identity of the list.
| `format` | `TEXT` | The version of the Delectus file format used in this file.
| `created` | `INTEGER` | The time that this list was created.
| `modified` | `INTEGER` | The time that this copy of the list was last modified.
|===

=== The `"listnames"` table

The `"listnames"` table records the user-assigned name of the list.

[cols="1,1,4",options="header"]
|===
| column | type | description
| `revision` | `INTEGER` | The count of changes to the list's name as of the latest edit.
| `origin` | `INTEGER` | The edit's origin, unique per Delectus process and listfile.
| `timestamp` | `INTEGER` | The time of the op's creation, according to the device that's running the Delectus process.
| `name` | `TEXT` | The user-specified name of the list.
|===

=== The `"comments"` table

The `"comments"` table records the user-assigned comment text describing the list.

[cols="1,1,4",options="header"]
|===
| column | type | description
| `revision` | `INTEGER` | The count of changes to the list's name as of the latest edit.
| `origin` | `INTEGER` | The edit's origin, unique per Delectus process and listfile.
| `timestamp` | `INTEGER` | The time of the op's creation, according to the device that's running the Delectus process.
| `comment` | `TEXT` | The user-specified comment text.
|===

=== The `"columns"` table

[cols="1,1,4",options="header"]
|===
| column | type | description
| `revision` | `INTEGER` | The op's revision number, unique per origin.
| `origin` | `INTEGER` | The op's origin, unique per (node,process,pathname) tuple.
| `timestamp` | `INTEGER` | The time of the op's creation, according to the creating device.
| `_[label]_+` | `_[ColumnDefinition]_+` | The attributes of column `_label_`.
|===

The field `_[label]_+` stands for one or more *userdata columns* of the list. The `"columns"` table stores one SQLite column for each userdata column. The SQLite column's label is `_label_`, and its attributes are given by a `*ColumnDefinition*` object.

A `*ColumnDefinition*` object is a JSON object of the following form:

[cols="1,2,6",options="header"]
|===
| attribute | type | description
| `label` | `string` | The column's unique label.
| `name` | `string` | The column's user-assigned name.
| `order` | `real` | The recommended presentation order of the column.
| `sort` | `null`, `'ASC'`, `'DESC'` | Whether to sort the list on this column, and in which direction. Only one column at a time may have a non-null value for this attribute.
| `title` | `Boolean` | Whether this is the list's *title column*. At most one column at a time may have a non-null value for this attribute.
| `subtitle` | `Boolean` | Whether this is the list's *subtitle column*. At most one column at a time may have a non-null value for this attribute.
| `deleted` | `Boolean` | Whether this column has been marked deleted.
|===


=== The `"items"` and `"latest_items"` tables
==== `"items"`
==== `"latest_items"`
